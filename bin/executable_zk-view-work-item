#!/usr/bin/env python
# vim: ft=python

from zoneinfo import ZoneInfo
import argparse
import datetime
import os
import zklib

parser = argparse.ArgumentParser(
    prog="zk-view-work-item",
    description="View or create a work item note in `zk` with details from `az`",
)

parser.add_argument(
    "notebook",
    help="Notebook directory from `zk` ($ZK_NOTEBOOK_DIR)",
    type=str,
)

parser.add_argument(
    "identifier",
    help="The work item identifier",
    type=int,
)

args = parser.parse_args()

workItemFile = "%s/work-item/wi-%s.md" % (args.notebook, args.identifier)

if os.path.isfile(workItemFile):
    zklib.zkEditFile(workItemFile)
    quit(0)

# If file does not exist, create it

workItem = zklib.azGetWorkItem(args.identifier)

extras = "application=%s,install-date=%s,state=%s,work-item-title=%s,work-item=%s" % (
    workItem.application,
    workItem.installDate,
    workItem.state,
    workItem.title,
    args.identifier,
)

zklib.zkNewNote("{}/work-item".format(args.notebook), str(args.identifier), extras)
