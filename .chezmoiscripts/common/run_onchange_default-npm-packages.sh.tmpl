#!/bin/sh
# vi: ft=bash

# hash: {{ include "dot_default-npm-packages.tmpl" | sha256sum }}
# https://github.com/asdf-vm/asdf-nodejs/blob/master/bin/install

install_default_npm_packages() {
  local default_npm_packages_file="${ASDF_NPM_DEFAULT_PACKAGES_FILE:=$HOME/.default-npm-packages}" filtered_packages=

  if ! [ -f "$default_npm_packages_file" ]; then
    return 0
  fi

  filtered_packages=$(grep -vE "^\s*#" < "$default_npm_packages_file")

  if [ "${filtered_packages-}" ]; then
    printf "Installing the following default packages globally: "
    xargs printf "%s, " <<< "$filtered_packages"
    printf "\x8\x8 \n" # Cleanup last comma

    (
      if [ -r "$ASDF_NODEJS_PLUGIN_DIR/bin/exec-env" ]; then
        . "$ASDF_NODEJS_PLUGIN_DIR/bin/exec-env"
      fi

      xargs env PATH="$ASDF_INSTALL_PATH/bin:$PATH" npm install -g <<< "$filtered_packages"
    )
  fi
}

install_default_npm_packages || printf "\nWARN! An error occurred when installing the default npm packages\n"
