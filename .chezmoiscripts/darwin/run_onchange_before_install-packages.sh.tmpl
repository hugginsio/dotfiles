#!/bin/sh # vi: ft=bash

# -e: exit on error
# -u: exit on unset variables
set -eu

echo "Installing essentials..."

brew update && brew upgrade && brew cleanup
brew bundle --no-lock --file=/dev/stdin <<EOF
tap "go-task/homebrew-tap"
tap "homebrew/cask-fonts"
tap "jesseduffield/lazygit"

brew "bat"
brew "colima"
brew "coreutils"
brew "curl"
brew "ed"
brew "findutils"
brew "fish"
brew "fzf"
brew "gawk"
brew "gh"
brew "git"
brew "glow"
brew "gnu-sed"
brew "gnu-tar"
brew "go"
brew "gpg"
brew "grep"
brew "jq"
brew "lazygit"
brew "make"
brew "minikube"
brew "neovim"
brew "ripgrep"
brew "ripgrep"
brew "slides"
brew "starship"
brew "tree"
brew "yq"
brew "go-task/tap/go-task"
cask "appcleaner"
cask "font-jetbrains-mono-nerd-font"
cask "microsoft-edge"
cask "microsoft-teams"
cask "raycast"
cask "stats"
cask "syntax-highlight"

EOF

# macOS defaults largely thanks to @mathiasbynens/dotfiles
echo "Setting system preferences..."

osascript -e 'tell application "System Preferences" to quit'

# Disable the sound effects on boot
sudo nvram SystemAudioVolume=" "

# Disable automatic capitalization
defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false

# Disable smart dashes as they’re annoying when typing code
defaults write NSGlobalDomain NSAutomaticDashSubstitutionEnabled -bool false

# Disable automatic period substitution
defaults write NSGlobalDomain NSAutomaticPeriodSubstitutionEnabled -bool false

# Disable smart quotes as they’re annoying when typing code
defaults write NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled -bool false

# Disable press-and-hold for keys in favor of key repeat
defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false

# Require password immediately after sleep or screen saver begins
defaults write com.apple.screensaver askForPassword -int 1
defaults write com.apple.screensaver askForPasswordDelay -int 0

# Save screenshots to the clipboard
defaults write com.apple.screencapture target -string "clipboard"

# Set $HOME as the default location for new Finder windows
defaults write com.apple.finder NewWindowTarget -string "PfHm"
defaults write com.apple.finder NewWindowTargetPath -string "file://${HOME}/"

# Finder: show all filename extensions
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Finder: show path bar
defaults write com.apple.finder ShowPathbar -bool true

# Keep folders on top when sorting by name
defaults write com.apple.finder _FXSortFoldersFirst -bool true

# When performing a search, search the current folder by default
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# Avoid creating .DS_Store files on network or USB volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

# Set the icon size of Dock items to 36 pixels
defaults write com.apple.dock tilesize -int 64

# Change minimize/maximize window effect
defaults write com.apple.dock mineffect -string "genie"

# Minimize windows into their application’s icon
defaults write com.apple.dock minimize-to-application -bool true

# Show indicator lights for open applications in the Dock
defaults write com.apple.dock show-process-indicators -bool true

# Wipe all (default) app icons from the Dock
defaults write com.apple.dock persistent-apps -array

# Automatically hide and show the Dock
defaults write com.apple.dock autohide -bool true

# Don’t show recent applications in Dock
defaults write com.apple.dock show-recents -bool false

# Use plain text mode for new TextEdit documents
defaults write com.apple.TextEdit RichText -int 0
# Open and save files as UTF-8 in TextEdit
defaults write com.apple.TextEdit PlainTextEncoding -int 4
defaults write com.apple.TextEdit PlainTextEncodingForWrite -int 4

echo "Restarting applications..."
for app in "Address Book" \
    "Calendar" \
    "cfprefsd" \
    "Dock" \
    "Finder" \
    "Mail" \
    "SystemUIServer"; do
killall "${app}" &> /dev/null
done
