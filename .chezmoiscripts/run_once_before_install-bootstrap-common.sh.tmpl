#!/bin/sh

# -e: exit on error
# -u: exit on unset variables
set -eu

{{ if eq .osid "darwin" -}}

echo "Detected: macOS"

echo "Installing Starship..."
sh -c "$(curl -fsLS https://starship.rs/install.sh)" -- --yes --base-url="https://github.com/starship/starship/releases"

{{ else if eq .osid "linux-debian" -}}

echo "Detected: Debian-like Linux"
echo "Upgrading packages and installing essentials..."

sudo apt-get -yqq update && sudo apt-get -yqq upgrade
sudo apt-get -yqq install --no-install-recommends git curl fzf vim

echo "Installing Starship..."
sh -c "$(curl -fsLS https://starship.rs/install.sh)" -- --yes --base-url="https://github.com/starship/starship/releases"

{{ if eq .chezmoi.osRelease.id "ubuntu" -}}

echo "Detected: Ubuntu"
echo "Adding repository ppa:fish-shell and installing fish..."

sudo apt-add-repository -y ppa:fish-shell/release-3
sudo apt-get -yqq update && sudo apt-get -yqq upgrade
sudo apt-get -yqq install --no-install-recommends fish

{{ else if eq .chezmoi.osRelease.id "debian" -}}

# TODO

{{ end -}}

echo "Cleaning up..."
sudo apt-get -yqq autoremove

{{ else -}}

echo "Detected: unsupported configuration \"{{ .osid -}}\""

{{ end -}}
